---
title: "Budgets"
author: "Jens Daniel MÃ¼ller"
date:  "`r format(Sys.time(), '%d %B, %Y')`"
output: 
  workflowr::wflow_html:
    number_sections: true
    toc_depth: 3
    toc_float:
      collapsed: false
editor_options:
  chunk_output_type: console
---

```{r define_parameters}

version_id_pattern <- "v"
config <- "vif_max"

```



```{r source_read_data_child, include = FALSE}


read <-
  knitr::knit_expand(
    file = here::here("analysis/child/budget_analysis_read_data.Rmd"),
    version_id_pattern = version_id_pattern,
    config = config
  )


```

`r knitr::knit(text = unlist(read))`

```{r order_vif_max_levels}

params_local_all <- params_local_all %>%
  mutate(vif_max = fct_inorder(vif_max))

```

```{r source_plot_data_child, include = FALSE}


plot <-
  knitr::knit_expand(
    file = here::here("analysis/child/budget_analysis_plot_data.Rmd"),
    version_id_pattern = version_id_pattern,
    config = config
  )


```

`r knitr::knit(text = unlist(plot))`


```{r test_predictor_analysis, fig.asp=2}

lm_best_predictor_counts_all <-
  full_join(lm_best_predictor_counts_all,
            params_local_all)

lm_best_predictor_counts_all <- lm_best_predictor_counts_all %>% 
  mutate(n_predictors_total = rowSums(across(aou:temp), na.rm = TRUE)/10)

lm_best_predictor_counts_all %>% 
  ggplot(aes(vif_max, n_predictors_total, col = period)) +
  geom_point() +
  facet_grid(gamma_slab ~ data_source)

lm_best_predictor_counts_all %>% 
  pivot_longer(aou:temp,
               names_to = "predictor",
               values_to = "count") %>% 
  ggplot(aes(vif_max, count, col = predictor)) +
  geom_point() +
  facet_grid(gamma_slab ~ data_source)


```


